<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="web80012176.css">
</head>
<style>

</style>
<body><img id="backg_eror" class="h_background" src="backg/Distorted_Fate.webp">
  <div>
    
  <div class="main-container">

    <div class="container box">
      <div id="left_div" >        
              
      </div>
      <div id="right_div" >
        
        <div id="right_div_a" >
            <div id="right_div_a-right_div_b">
                <div id="right_div_a-right_div_b-right_div_0">
                  <h1>Hatsune Miku</h1>
                  <div id="info"></div>
                  <input type="text" id="text" placeholder="Nhập tags (vd: hatsune_miku long_hair)" autocomplete="off">
                  <ul id="suggestions"></ul>
                  <!-- <input type="number" id="number" placeholder="Số lượng ảnh (<=50)" max="50" min="1"> -->
                  <button onclick="tiepTheo()">Tiếp theo</button>
                </div>
                <div id="right_div_a-right_div_b-right_div_1">
                </div>
                <div id="right_div_a-right_div_b-right_div_2"></div>
                <div id="right_div_a-right_div_b-right_div_c">
                    
                    
                </div>
                
            </div>
            <div id="right_div_a-right_div_3"></div>
        </div>
            
      </div>
    </div>
  </div>
</div>
</body>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const scrollContainer = document.getElementById('right_div_a-right_div_b');
    const bgImage = document.getElementById('backg_eror');
    let ytang_0=0
    let Right_div_b=document.getElementById("right_div_a-right_div_b")
    let index = 0;
    if (!scrollContainer || !bgImage) return;
    let timeoutId = null;

    scrollContainer.addEventListener('scroll', function () {
      if (scrollContainer.scrollTop > 200 &&  220 > scrollContainer.scrollTop) {
   
        bgImage.setAttribute('src', 'backg/404-13.gif' );


        if (timeoutId) clearTimeout(timeoutId);

   
        timeoutId = setTimeout(function () {
          bgImage.setAttribute('src','backg/Distorted_Fate.webp');
          }, 200);
        }
      });
    });


function search_tag(_ass) {
  const input = document.getElementById("text");
  const suggestionsBox = document.getElementById("suggestions");

  input.addEventListener("input", function () {
    const query = this.value.toLowerCase();

    let suggestions = [];
    if (query !== "") {
      suggestions = _ass
        .filter(item => item.toLowerCase().includes(query))
        .slice(0, 100); // Giới hạn 10 gợi ý
    }

    const suggestionsHTML = suggestions.map(item => 
      `<li onclick="selectSuggestion('${item}')">${item}</li>`
    ).join("");

    suggestionsBox.innerHTML = suggestionsHTML;
  });
}

// Đặt bên ngoài để global
function selectSuggestion(value) {
  document.getElementById("text").value = value;
  document.getElementById("suggestions").innerHTML = "";
}


    async function tiepTheo() {
      const btn_0 = document.getElementById('text').value.trim();
      const btn_1 = 50
      // parseInt(document.getElementById('number').value);
      // if (!btn_0 || !btn_1 || btn_1 > 500 || btn_1 < 1) {
      //   alert("Vui lòng nhập đúng tag và số lượng (1–50)");
      //   return;
      // }


      try {
        const url = `https://safebooru.org/index.php?page=dapi&s=post&q=index&json=1&tags=${encodeURIComponent(btn_0)}&limit=${btn_1}&pid=${0}`;
        const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;
        const response = await fetch(proxyUrl);

        const text = await response.text();  // codetabs trả về dạng text gốc
        const data = JSON.parse(text);       // sau đó ta mới parse

        if (data.length === 0) {
          alert("Hết ảnh hoặc không có ảnh phù hợp.");
          return;
        }

        let img_html = '';
        Tao_khoi_tu_dong(0, data,[])
        // for (let img of data) {
        //   img_html += `<img src="https://safebooru.org/images/${img.directory}/${img.image}" style="max-width:100%;margin:10px 0;">`;
        //   console.log(img);
        // }

        
        // index++;
      } catch (e) {
        console.error("Lỗi:", e);
        alert("Đã xảy ra lỗi khi tải ảnh. Vui lòng thử lại.");
      }
    }
    
    function Tao_khoi_tu_dong(n,arr,arr1) {
        if (true){
            const new_div=arr.slice(0,10).map((item) => {
                return`<button class="left_div-button_0" onclick="tang_trang()">the loai</button>`
            }).join('');
            document.querySelector('#left_div').innerHTML = new_div
        }
         if (true){
            const new_div=arr.slice(n,n+15).map((item) => {
              var name_a=item.owner.substring(0,15 )
              
              console.log(name_a)
                return`<button class="right_div_b-right_div_1-button_1">
                  <div class='img_0_a'>
                    <img class='img_0' src="https://safebooru.org/images/${item.directory}/${item.image}">
                  </div>
                  <div class='img_0_b'>
                   <img class='img_0_b_0' src="https://safebooru.org/images/${item.directory}/${item.image}">
                    <div class='img_0_b_1'>${name_a}...</div>
                  </div></button>`
            }).join('');
            document.querySelector('#right_div_a-right_div_b-right_div_1').innerHTML = new_div
        }
         if (true){
            const new_div=arr.slice(n+15,n+30).map((item) => {
                return`<button class="right_div_b-right_div_2-button_2"><img class='img_0' src="https://safebooru.org/images/${item.directory}/${item.image}"></button>`
            }).join('');
            document.querySelector('#right_div_a-right_div_b-right_div_2').innerHTML = new_div
        }
         if (true){
            const new_div=arr.slice(n+30,n+50).map((item) => {
                return`<button class="right_div_a-right_div_3-button_3">   <img class='img_0' src="https://safebooru.org/images/${item.directory}/${item.image}"></button>`
            }).join('');
            document.querySelector('#right_div_a-right_div_3').innerHTML = new_div
        }
        
        
    }
    
    tiepTheo()
    
    // function tang_trang(){
    //   ytang_0+=1
    //   console.log(ytang_0) 
    //   Right_div_b.scrollTop=0
      
    //   return uploading(ytang_0*50)
            
            
   

    // }
    // const arr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
    // const arr1=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
    fetch('img_tags_beta.json')
        .then(response => response.json())
        .then(_ass => {
          search_tag(_ass)
        })
            
            
            
    //     })
    // function uploading(n){
    //   fetch('file_list.json')
    //     .then(response => response.json())
    //     .then(data => {
    //         Tao_khoi_tu_dong(n, data,[])
            
            
    //     })
    // }



    
</script>
</html>